# Telegram Messaging API Service

## Описание проекта

Прокси-бот для Телеграма. Бот сохраняет телефонные номера и Telegram ID для отправки сообщений через API.
## Ключевые возможности

- Регистрация и связывание номера телефона пользователя с его Telegram ID.
- отправка текстомы сообщений через REST API.

## Технологии
- **MySQL**: СУБД для хранения данных.
- **Gin**: HTTP web framework
- **Telegram Bot API v5.5.1**:
- **GORM v1.25.10**: ORM для взаимодействия с базами данных.
- **Zap**: Библиотека для логирования в Go.

### Описание структуры базы данных `sbot_db`

**Название таблицы:** `user_phone_mapping`

**Описание:** Таблица используется для хранения соответствия между номерами телефонов пользователей и их идентификаторами в Telegram. Это позволяет принимать запросы по API, используя номер телефона, и преобразовывать его в идентификатор пользователя для отправки сообщений.

**Структура таблицы:**

| Поле | Тип данных | Описание |
| --- | --- | --- |
| `phone_number` | `VARCHAR(16)` | Номер телефона пользователя. Уникальное поле, используемое как первичный ключ. |
| `telegram_chat_id` | `int(10)` | Идентификатор чата пользователя в Telegram. |
| `created_at` | `TIMESTAMP` | Время создания записи. По умолчанию устанавливается текущее время. |
| `updated_at` | `TIMESTAMP` | Время последнего обновления записи. Обновляется автоматически при изменении записи. |
| `deleted_at` | `TIMESTAMP` | Время удаления записи. Если поле заполнено, считается, что запись удалена. |

**Индексы:**

- **Первичный ключ:** `phone_number`

Эта структура поддерживает быстрый поиск и обновление данных, обеспечивая эффективное взаимодействие с API для обработки сообщений в Telegram на основе номера телефона пользователя.

### Описание API Endpoint

**POST /V1/messages/**

Данный endpoint позволяет отправлять текстовые сообщения пользователям. Он принимает JSON-объект с номером телефона получателя и текстом сообщения.

**Тело запроса:**

```json
{
  "to": "{{Recipient-Phone-Number}}",
  "type": "text",
  "text": {
    "body": "text-message-content"
  }
}
```

### Параметры запроса

| Параметр | Тип | Описание |
| --- | --- | --- |
| `to` | строка | Номер телефона получателя сообщения. |
| `type` | строка | Тип сообщения. Поддерживается только тип "text". |
| `text` | объект | Содержит поле `body`, в котором указывается текст сообщения. |
**Пример использования:**

Чтобы отправить сообщение "Привет" на номер "1234567890", тело запроса будет выглядеть следующим образом:

```json
{
  "to": "1234567890",
  "type": "text",
  "text": {
    "body": "Привет"
  }
}
```

**Ответы сервера:**

- `200 OK`: сообщение успешно отправлено.
- `400 Bad Request`: ошибка в данных запроса.
- `401 Unauthorized`: ошибка аутентификации. Отсутствует или неверный токен аутентификации.
- `404`:  пользователь не найден
- `500 Internal Server Error`: внутренняя ошибка сервера.

### Аутентификация

Для использования данного API необходимо включить в заголовки запроса токен аутентификации. Пример заголовка:

```makefile
Authorization: Bearer YOUR_ACCESS_TOKEN`
```


### Сценарий диалога и ветвления:

#### 1\. Приветствие и запрос номера телефона:

- **Бот:** Добро пожаловать! Спасибо, что выбрали наш сервис. Для начала работы с нами, пожалуйста, предоставьте Ваш контактный номер телефона.
- **Кнопки:** \[Отправить номер телефона\] (кнопка запроса контакта)
- **Пользователь:** (Отправляет номер телефона или текст)
    - **Если отправлен номер:** Переход к шагу 2.
    - **Если отправлен текст:** "Пожалуйста, используй кнопку для отправки номера телефона."

#### 2\. Запоминание номера и подтверждение:

- **Бот:** Ваш номер телефона успешно сохранён.
- **Кнопки:**
- - \[О нас\] (информация о боте)
- **Пользователь:** (Любой ответ)
    - **Обработка:** Бот ожидает запросы через API или пользователь может написать "Помощь".

#### 3\. Информация о боте:
- **Бот:** Прокси-бот для Телеграма.  Бот сохраняет телефонные номера и Telegram ID для отправки сообщений через API.